---
title: k8s课堂笔记
date: 2021-03-16 20:02:08
tags: kubernetes
---

# 第一部分 k8s基本概念

## k8s概述和特性

### k8s概述

* k8s是谷歌在2014年开业的容器化集群管理系统
* 使用k8s进行容器化应用部署
* 使用k8s利于应用扩展
* k8s目标实施让部署容器化应用更加简洁和高效



### k8s特性

#### 自动装箱

* 基于容器对应用运行环境的资源配置要求自动部署应用容器

#### 自我修复

* 当容器失败时，会对容器进行重启
* 当所部署的 Node 节点有问题时，会对容器进行重新部署和重新调度
* 当容器未通过监控检查时，会关闭此容器直到容器正常运行时，才会对外提供服务

#### 水平扩展

* 通过简单的命令、用户 UI 界面或基于 CPU 等资源使用情况，对应用容器进行规模扩大 或规模剪裁

#### 服务发现

* 用户不需使用额外的服务发现机制，就能够基于 Kubernetes 自身能力实现服务发现和 负载均衡

#### 滚动更新

* 可以根据应用的变化，对应用容器运行的应用，进行一次性或批量式更新

#### 版本回退

* 可以根据应用部署情况，对应用容器运行的应用，进行历史版本即时回退

#### 密钥和配置管理

* 在不需要重新构建镜像的情况下，可以部署和更新密钥和应用配置，类似热部署。

#### 存储编排

* 自动实现存储系统挂载及应用，特别对有状态应用实现数据持久化非常重要
* 存储系统可以来自于本地目录、网络存储(NFS、Gluster、Ceph 等)、公共云存储服务

#### 批处理

* 提供一次性任务，定时任务;满足批量数据处理和分析的场景



## k8s架构组件

{% asset_img k8s集群架构组件.png k8s集群架构组件 %}

在硬件级别, 一个 Kubernetes 集群由很多节点组成, 这些节点被分成以下两种类型:

* 主节点: 承载着 Kubernetes 控制和管理整个集群系统的控制面板
  * 控制面板
    * *Kubernetes* API 服务器, 你和其他控制面板组件都要和它通信。集群统一入口，以restful方式，交给etcd存储。
    * *Scheculer* 它调度你的应用 (为应用的每个可部署组件分配一个工作节点)。
    * *Controller Manager* 它执行集群级别的功能, 如复制组件、持续跟踪工作节点、处理节点失败。
    * *etcd* 一个可靠的分布式数据存储, 它能持久化存储集群配置。
  * 控制面板的组件持有并控制集群状态, 但是它们不运行你的应用程序, 是由工作节点完成的。
* 工作结点: 它们运行用户实际部署的应用
  * Docker, rtk 或其他的容器类型
  * *Kubelet* 它与 API 服务器通信, 并管理它所在节点的容器。master派到worker的代表，管理本机。
  * *Kubernetes Service Proxy (kube-proxy)* 它负责组件之间的负载均衡网络流量



## k8s核心概念

### pod

* 最小的部署单元
* 一组容器的集合
* 共享网络
* 生命周期是短暂的



### Controller

* 确保预期的pod副本数量
* 无状态应用部署
* 有状态应用部署
  * 网络ip需要唯一
  * 依赖存储

确保所有的node运行同一个pod

一次性任务和定时任务



### Service

* 定义一组pod的访问规则



# 第二部分 搭建k8s集群

## 搭建k8s环境平台规划

### 单master集群

{% asset_img 单master集群.png 单master集群 %}



### 多master集群

{% asset_img 多master集群.png 多master集群 %}









## 搭建k8s集群部署方式

